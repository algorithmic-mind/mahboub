{% extends 'base.html' %}
{% load static %}

{% block title %}کتابخانه محبوب{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/books.css' %}">
{% endblock %}

{% block content %}

<div class="page-header">
    <h1 class="page-title">
        <i class="fas fa-book"></i>
        کتابخانه محبوب
    </h1>
    <p class="page-subtitle">مجموعه کامل کتاب‌های مذهبی و معارف اسلامی</p>
</div>

{% for cat, books in grouped_books.items %}
<div class="content-box">
    <div class="section-header">
        <div class="section-title">
            {% if cat.icon %}<i class="{{ cat.icon }}"></i>{% else %}<i class="fas fa-book-open"></i>{% endif %}
            {{ cat.name }}
        </div>
        <a href="{% url 'books:books_by_category' cat.slug %}" class="view-all">
            مشاهده همه
            <i class="fas fa-chevron-left"></i>
        </a>
    </div>

    <div class="books-row">
        {% for book in books %}
        <a href="{% url 'books:book_detail' book.slug %}" class="book-item">

            {# ── جلد ── #}
            {% if book.cover_image %}
            <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="book-cover-img">
            {% else %}
            <div class="book-cover-placeholder" style="background:{{ book.gradient }};">
                <i class="fas fa-{{ book.cover_icon }}"></i>
                {% if book.is_featured %}
                    <span class="book-badge">پرفروش</span>
                {% elif book.access_type == 'free' %}
                    <span class="book-badge free">رایگان</span>
                {% endif %}
            </div>
            {% endif %}

            {# ── اطلاعات ── #}
            <div class="book-info">
                <div class="book-title">{{ book.title|truncatechars:28 }}</div>
                <div class="book-author">{{ book.author|truncatechars:18 }}</div>
                <div class="book-rating">
                    <i class="fas fa-star"></i> {{ book.rating }}
                </div>
                {% if book.access_type == 'free' %}
                <div class="book-price">رایگان</div>
                {% elif book.discount_percent > 0 %}
                <div class="book-price">
                    {{ book.final_price|floatformat:0 }} تومان
                    <span class="discount">{{ book.price|floatformat:0 }}</span>
                </div>
                {% else %}
                <div class="book-price">{{ book.price|floatformat:0 }} تومان</div>
                {% endif %}
            </div>

        </a>
        {% endfor %}
    </div>
</div>
{% empty %}
<div style="text-align:center;padding:48px 16px;color:var(--text-secondary);">
    <i class="fas fa-book" style="font-size:40px;margin-bottom:12px;display:block;opacity:.3;"></i>
    <p>هیچ کتابی موجود نیست.</p>
</div>
{% endfor %}

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/books.js' %}"></script>
{% endblock %}